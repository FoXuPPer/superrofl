<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speedtest Mini App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .container {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #005f99;
        }
        #result {
            margin-top: 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Speedtest</h1>
        <button onclick="runSpeedTest()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
        <div id="result">–ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç.</div>
    </div>

    <script>
        // URL —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –ø—É–±–ª–∏—á–Ω—ã–π)
        const TEST_SERVER_URL = "http://speedtest.tele2.net/10MB.zip"; // –ü—É–±–ª–∏—á–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª (10 –ú–ë)
        const TEST_FILE_SIZE_MB = 10; // –†–∞–∑–º–µ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ –ú–ë

        async function runSpeedTest() {
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = "–ó–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏... üì°";

            try {
                // –ò–∑–º–µ—Ä—è–µ–º –ø–∏–Ω–≥ (–≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ HEAD-–∑–∞–ø—Ä–æ—Å)
                const pingStart = performance.now();
                await fetch("http://speedtest.tele2.net/ping", { method: "HEAD" });
                const ping = performance.now() - pingStart;

                // –ò–∑–º–µ—Ä—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ (download)
                const downloadStart = performance.now();
                const response = await fetch(TEST_SERVER_URL);
                const blob = await response.blob();
                const downloadTime = (performance.now() - downloadStart) / 1000; // –í—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                const downloadSpeed = (TEST_FILE_SIZE_MB * 8) / downloadTime; // –ú–±–∏—Ç/—Å

                // –ò–∑–º–µ—Ä—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–≥—Ä—É–∑–∫–∏ (upload)
                const uploadStart = performance.now();
                const formData = new FormData();
                formData.append("file", new Blob([new ArrayBuffer(TEST_FILE_SIZE_MB * 1024 * 1024)]));
                // –î–ª—è —Ç–µ—Å—Ç–∞ –≤—ã–≥—Ä—É–∑–∫–∏ –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç POST-–∑–∞–ø—Ä–æ—Å—ã
                // –ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É, —Ç–∞–∫ –∫–∞–∫ –ø—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å upload
                // –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä, –∑–∞–º–µ–Ω–∏ URL –Ω–∏–∂–µ
                const uploadResponse = await fetch("http://speedtest.example.com/upload", {
                    method: "POST",
                    body: formData
                });
                const uploadTime = (performance.now() - uploadStart) / 1000; // –í—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                const uploadSpeed = (TEST_FILE_SIZE_MB * 8) / uploadTime; // –ú–±–∏—Ç/—Å

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                resultDiv.innerHTML = `
                    üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏:<br><br>
                    –í—Ö–æ–¥—è—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${downloadSpeed.toFixed(2)} –ú–±–∏—Ç/—Å<br>
                    –ò—Å—Ö–æ–¥—è—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${uploadSpeed.toFixed(2)} –ú–±–∏—Ç/—Å<br>
                    –ü–∏–Ω–≥: ${ping.toFixed(2)} –º—Å<br><br>
                    –î–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π Speedtest.net.
                `;

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–æ—Ç—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                window.Telegram.WebApp.sendData(JSON.stringify({
                    download: downloadSpeed.toFixed(2),
                    upload: uploadSpeed.toFixed(2),
                    ping: ping.toFixed(2)
                }));
            } catch (error) {
                resultDiv.innerHTML = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞. üòî";
                console.error(error);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω
    </script>
</body>
</html>
